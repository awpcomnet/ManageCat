<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cat.manage.base.dao.SingleproductDao">

	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"></cache>

	<resultMap type="com.cat.manage.base.domain.Singleproduct" id="singleproductResultMap">
		<id property="singleId" column="single_id"/>
		<result property="singleName" column="single_name"/>
		<result property="singleEname" column="single_ename"/>
		<result property="capacity" column="capacity"/>
		<result property="unit" column="unit"/>
		<result property="ofOrigin" column="of_origin"/>
		<result property="isUse" column="is_use"/>
		<result property="createDate" column="create_date"/>
		<result property="updateDate" column="update_date"/>
		<result property="createBy" column="create_by"/>
		<result property="updateBy" column="update_by"/>
		<result property="createDateFormat" column="createDateFormat"/>
		<result property="updateDateFormat" column="updateDateFormat"/>
		<result property="ofOriginName" column="of_origin_name"/>
		<result property="brandId" column="brand_id"/>
		<result property="brandName" column="brand_name"/>
		<result property="brandEname" column="brand_ename"/>
	</resultMap>
	
	<!-- 添加单品信息 -->
	<insert id="addSingleproduct" parameterType="com.cat.manage.base.domain.Singleproduct">
		insert into t_singleproduct( single_name, single_ename, of_origin, capacity, unit, is_use, create_date, create_by , update_date, update_by)
		values(#{singleName}, #{singleEname}, #{ofOrigin}, #{capacity}, #{unit}, #{isUse}, now(), 'system', now(), 'system')
	</insert>
	
	<!-- 修改单品信息 -->
	<update id="updateSingleproduct" parameterType="com.cat.manage.base.domain.Singleproduct">
		update t_singleproduct set update_date=now() , update_by = 'system'
		<if test="singleName != null and singleName != ''">
			, single_name = #{singleName}
		</if>
		<if test="singleEname != null and singleEname != ''">
			, single_ename = #{singleEname}
		</if>
		<if test="capacity != null and capacity != ''">
			, capacity = #{capacity}
		</if>
		<if test="unit != null and unit != ''">
			, unit = #{unit}
		</if>
		<if test="ofOrigin != null and ofOrigin != ''">
			, of_origin = #{ofOrigin}
		</if>
		<if test="isUse != null and isUse != ''">
			, is_use = #{isUse}
		</if>
		where single_id = #{singleId}
	</update>
	
	<!-- 删除单品信息 -->
	<delete id="deleteSingleproduct" parameterType="java.lang.Integer">
		delete from t_singleproduct where single_id = #{singleId}
	</delete>
	
	<!-- 根据系列编号删除单品信息 -->
	<delete id="deleteSingleproductBySeriesIds">
		delete from t_singleproduct where of_origin in
		<foreach collection="array" item="seriesId" open="(" separator="," close=")">#{seriesId}</foreach>
	</delete>
	
	<!-- 查询单品信息 -->
	<!-- <select id="querySingleproducts" parameterType="com.cat.manage.base.domain.Singleproduct" resultMap="singleproductResultMap"> -->
	<select id="querySingleproducts" resultMap="singleproductResultMap">
		select single_id, single_name, single_ename, capacity, unit, of_origin, (select series_name from t_series where series_id = t_singleproduct.of_origin) as of_origin_name, is_use, create_date, create_by, update_date, update_by, date_format(create_date, '%Y年%m月%d日 %T') as createDateFormat, date_format(update_date, '%Y年%m月%d日 %T') as updateDateFormat 
		, (select b.brand_id from t_brand b, t_series s where s.of_origin=b.brand_id and s.series_id=t_singleproduct.of_origin) as brand_id
		, (select b.brand_name from t_brand b, t_series s where s.of_origin=b.brand_id and s.series_id=t_singleproduct.of_origin) as brand_name
		, (select b.brand_ename from t_brand b, t_series s where s.of_origin=b.brand_id and s.series_id=t_singleproduct.of_origin) as brand_ename
		from t_singleproduct where 1=1
		<if test="param1.capacity != null and param1.capacity != ''">
			and capacity = #{param1.capacity}
		</if>
		<if test="param1.unit != null and param1.unit != ''">
			and unit = #{param1.unit}
		</if>
		<if test="param1.ofOrigin != null and param1.ofOrigin != ''">
			and of_origin = #{param1.ofOrigin}
		</if>
		<if test="param1.isUse != null and param1.isUse != ''">
			and is_use = #{param1.isUse}
		</if>
		<if test="param1.singleName != null and param1.singleName != ''">
			and single_name like '%${param1.singleName}%'
		</if>
		<if test="param1.singleEname != null and param1.singleEname != ''">
			and single_ename like '%${param1.singleEname}%' 
		</if>
		<if test="param2 != null and param2 != ''">
			and of_origin in (select series_id from t_series where of_origin = #{param2})
		</if>
		order by create_date desc
	</select>
	
	<!-- 根据单品编号查询单品信息 -->
	<select id="querySingleproductBySingleId" parameterType="java.lang.Integer" resultMap="singleproductResultMap">
		select single_id, single_name, single_ename, capacity, unit, of_origin, (select series_name from t_series where series_id = t_singleproduct.of_origin) as of_origin_name, is_use, create_date, create_by, update_date, update_by, date_format(create_date, '%Y年%m月%d日 %T') as createDateFormat, date_format(update_date, '%Y年%m月%d日 %T') as updateDateFormat 
		, (select b.brand_id from t_brand b, t_series s where s.of_origin=b.brand_id and s.series_id=t_singleproduct.of_origin) as brand_id
		, (select b.brand_name from t_brand b, t_series s where s.of_origin=b.brand_id and s.series_id=t_singleproduct.of_origin) as brand_name
		from t_singleproduct where single_id = #{singleId}
	</select>
</mapper>