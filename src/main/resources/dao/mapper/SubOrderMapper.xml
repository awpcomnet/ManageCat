<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cat.manage.order.dao.SubOrderDao">
	<resultMap type="com.cat.manage.order.domain.SubOrder" id="subOrderResultMap">
		<id property="suborderId" column="suborder_id"/>
		<result property="superOrderId" column="super_order_id"/>
		<result property="brandId" column="brand_id"/>
		<result property="seriesId" column="series_id"/>
		<result property="singleId" column="single_id"/>
		<result property="num" column="num"/>
		<result property="orderPrice" column="order_price"/>
		<result property="transferPrice" column="transfer_price"/>
		<result property="costPrice" column="cost_price"/>
		<result property="sellingPrice" column="selling_price"/>
		<result property="curState" column="curstate"/>
		<result property="createDate" column="create_date"/>
		<result property="updateDate" column="update_date"/>
	</resultMap>
	
	<!-- 添加订单 -->
	<insert id="addSubOrder" parameterType="com.cat.manage.order.domain.SubOrder">
		insert into t_suborder (super_order_id, brand_id, series_id, single_id, num, order_price,transfer_price, cost_price,selling_price, curstate,create_date, update_date)
		values(#{superOrderId}, #{brandId}, #{seriesId}, #{singleId}, #{num}, #{orderPrice}, #{transferPrice}, #{costPrice}, #{sellingPrice}, #{curState}, now(), now())
	</insert>
	
	<!-- 查询单个订单 -->
	<select id="querySubOrderById" parameterType="java.lang.Integer" resultMap="subOrderResultMap">
		select suborder_id, super_order_id, brand_id, series_id, single_id, num, order_price,transfer_price, cost_price,selling_price, curstate,create_date, update_date 
		from t_suborder where suborder_id = #{suborderId}
	</select>
	
	
	<!-- 查询所有订单 -->
	<select id="querySubOrderAll" resultMap="subOrderResultMap">
		select suborder_id, super_order_id, brand_id, series_id, single_id, num, order_price,transfer_price, cost_price,selling_price, curstate, date_format(create_date, '%Y年%m月%d日 %T') as create_date, date_format(update_date, '%Y年%m月%d日 %T') as update_date
		from t_suborder where 1=1
		<if test="startTime != null and startTime != ''">
			and DATE_FORMAT(create_date, '%Y%m%d') &gt;= #{startTime, jdbcType=VARCHAR}
		</if>
		<if test="endTime != null and endTime != ''">
			and DATE_FORMAT(create_date, '%Y%m%d') &lt;= #{endTime, jdbcType=VARCHAR}
		</if>
		
		 order by create_date desc
	</select>
	
	<!-- 修改单个日历 -->
	<update id="updateSubOrder" parameterType="com.cat.manage.order.domain.SubOrder"> 
		update t_suborder set update_date=now()
		<if test="superOrderId != null and superOrderId != ''">
			, super_order_id = #{superOrderId}
		</if>
		<if test="brandId != null and brandId != ''">
			, brand_id= #{brandId}
		</if>
		<if test="seriesId != null and seriesId != ''">
			, series_id= #{seriesId}
		</if>
		<if test="singleId != null and singleId != ''">
			, single_id= #{singleId}
		</if>
		<if test="num != null and num != ''">
			, num= #{num}
		</if>
		<if test="orderPrice != null and orderPrice != ''">
			, order_price= #{orderPrice}
		</if>
		<if test="transferPrice != null and transferPrice != ''">
			, transfer_price= #{transferPrice}
		</if>
		<if test="costPrice != null and costPrice != ''">
			, cost_price= #{costPrice}
		</if>
		<if test="sellingPrice != null and sellingPrice != ''">
			, selling_price= #{sellingPrice}
		</if>
		<if test="curState != null and curState != ''">
			, curstate= #{curState}
		</if>
		 where suborder_id = #{suborderId}
	</update>
	
	<insert id="addSubOrderForCopy" parameterType="java.lang.Integer">
		insert into t_suborder(super_order_id, brand_id, series_id, single_id, num, order_price,transfer_price, cost_price,selling_price, curstate,create_date, update_date)
		select super_order_id, brand_id, series_id, single_id, #{num,jdbcType=INTEGER} , order_price,transfer_price, cost_price,selling_price, curstate, now(), now()
		from t_suborder where suborder_id = #{subOrderId,jdbcType=INTEGER}
	</insert>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>